<!DOCTYPE html>
<!--suppress ALL -->
<html>
<head>
    <meta charset="utf-8">
    <title>Ordina JWorks Tech Blog</title>
    <!-- Description, Keywords and Author -->
    <meta name="description" content="Ordina JWorks Tech blog
">
    <meta name="keywords" content="Ordina,ORAJ,JWorks,Blog,Java,Javascript,DevOps">
    <meta name="author" content="Ordina Belgium">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Styles -->
    <!-- Bootstrap CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font awesome CSS -->
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <!-- Magnific Popup -->
    <link href="/css/magnific-popup.css" rel="stylesheet">
    <!-- Owl carousel -->
    <link href="/css/owl.carousel.css" rel="stylesheet">

    <!-- CSS for this page -->

    <!-- Base style -->
    <link href="/css/styles/style.css" rel="stylesheet">
    <!-- Skin CSS -->
    <link href="/css/styles/skin-orange.css" rel="stylesheet" id="color_theme">

    <!-- Syntax highlighting -->
    <link href="/css/syntax.css" rel="stylesheet">

    <!-- Custom CSS. Type your CSS code in custom.css file -->
    <link href="/css/custom.css" rel="stylesheet">

    <!-- Favicon -->
    <link rel="shortcut icon" href="#">

    <script src="https://use.typekit.net/gzh0mbm.js"></script>
    <script>
        try {
            Typekit.load({async: true});
        } catch (e) {
        }
    </script>
</head>

<!-- Add class "boxed" along with body for boxed layout. -->
<!-- Add "pattern-x" (1 to 5) for background patterns. -->
<!-- Add "img-x" (1 to 5) for background images. -->
<body>

<!-- Outer Starts -->
<div class="outer">
    <!-- Header two Starts -->
    <div class="header-2">

        <!-- Container -->
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <div class="logo">
                        <h1><a href="/"><img src="/img/jworks/jworks-400x400.jpg"
                                                               width="100"
                                                               height="100"/> </a></h1>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="navy">
                        <ul>
                            <li><a href="/">Home</a></li>
                            <li><a href="/about/">About Us</a></li>
                            <li><a href="/contact">Contact Us</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Header two ends -->

    <!-- Main content starts -->

    <div class="main-block">

        <!-- Page heading two starts -->

        <div class="page-heading-two">
            <div class="container">
                <h2>JWorks Tech Blogs<span style="margin-left: 10px"> Powered by Ordina</span></h2>

                <div class="clearfix"></div>
            </div>
        </div>

        <!-- Page heading two ends -->

        <div class="container tk-acumin-pro">
            <div class="post">
    
    <div class="row">
        <div class="col-md-12">
            <h1>Digitally signing your JSON documents</h1>
            <p id="post-meta">
                Posted Mar 11, 2016 in <a href="/categories/security/">Security</a> by <a href="/author/tim-ysewyn/">Tim Ysewyn</a> 
                
                    <br />
                    <i class="fa fa-tags"></i>
                        
                            <a href="/tags/security/">Security</a>,
                        
                            <a href="/tags/jose/">JOSE</a>,
                        
                            <a href="/tags/jws/">JWS</a>,
                        
                            <a href="/tags/json-web-signature/">JSON Web Signature</a>
                        
                
            </p>
        </div>
    </div>
    <br />
    <article class="post-content">
        <h2 id="what-is-a-digital-signature">What is a digital signature?</h2>

<p>A digital signature is a mathematical scheme for demonstrating the authenticity of a digital message or documents.
A valid digital signature gives a recipient reason to believe that the message was created by a known sender, that the sender cannot deny having sent the message (<strong>authentication</strong> and <strong>non-repudiation</strong>), and that the message was not altered in transit (<strong>integrity</strong>).</p>

<p>Digital signatures are a standard element of most cryptographic protocol suites.
They are commonly used for software distribution, financial transactions, and in other cases where it is important to detect forgery or tampering.</p>

<p>Non-repudiation refers to a state of affairs where the author of a statement will not be able to successfully challenge the authorship of the statement or validity of an associated contract.
The term is often seen in a legal setting wherein the authenticity of a signature is being challenged.
In such an instance, the authenticity is being “repudiated”.</p>

<p><br /></p>

<h2 id="meet-jose">Meet JOSE</h2>

<p><a href="https://www.iana.org/assignments/jose/jose.xhtml">JOSE</a> is a framework intended to provide a method to securely transfer claims (such as authorization information) between parties.
The JOSE framework consists of several specifications to serve this purpose:</p>

<ul>
  <li><a href="#jwk">JWK</a> – JSON Web Key, describes format and handling of cryptographic keys in JOSE</li>
  <li><a href="#jws">JWS</a> – JSON Web Signature, describes producing and handling signed messages</li>
  <li><a href="#jwe">JWE</a> – JSON Web Encryption, describes producing and handling encrypted messages</li>
  <li><a href="#jwa">JWA</a> – JSON Web Algorithms, describes cryptographic algorithms used in JOSE</li>
  <li><a href="#jwt">JWT</a> – JSON Web Token, describes representation of claims encoded in JSON and protected by JWS or JWE</li>
</ul>

<p><br /></p>

<h2 id="jwk">JWK</h2>

<p>A JSON Web Key (<a href="https://tools.ietf.org/html/rfc7517">RFC7517</a>) is a JavaScript Object Notation (JSON) data structure that represents a cryptographic key.</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    </span><span class="p">{</span><span class="w"> 
        </span><span class="nt">"kty"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EC"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"crv"</span><span class="p">:</span><span class="w"> </span><span class="s2">"P-256"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="s2">"f83OJ3D2xF1Bg8vub9tLe1gHMzV76e8Tus9uPHvRVEU"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x_FEzRu9m36HLN_tue659LNpXW6pCyStikYjKIWI5a0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sig"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"kid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Public key used to sign our messages"</span><span class="w">
    </span><span class="p">}</span></code></pre></figure>

<p>In this example you can see a couple of parameters.
The first of them “kty” defines the key type, which is a mandatory field.
Depending on the type you’ve chosen other parameters can be set, like you see above.
As our type is EC, or Elliptic Curve, we want to specify the type of curve and our point.
Next to these parameters we also have the optional “use” to denote intended usage of the key and “kid” as key ID.
At the time of writing there are 3 supported key types: “EC”, “RSA” and “oct”.
While “EC” and “RSA” are used for assymmetric encryption, “oct” is used for symmetric encryption</p>

<p><br /></p>

<h2 id="jws">JWS</h2>

<p>The JSON Web Signature (<a href="https://tools.ietf.org/html/rfc7515">RFC7515</a>) standard describes the process of creation and validation of a datastructure representing a signed payload.
Assume someone wants to transfer an amount of money to his savings account.
This action could be represented like the following JSON:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    </span><span class="p">{</span><span class="w"> 
        </span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tim Ysewyn"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"account"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Checking account"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"to"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tim Ysewyn"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"account"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Savings account"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">250</span><span class="p">,</span><span class="w">
        </span><span class="nt">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EUR"</span><span class="w">
    </span><span class="p">}</span></code></pre></figure>

<p>In this example we are using a JSON document, but this is not relevant for the signing procedure.
Before we can sign this we need to convert this to base64url encoding, which will be our payload.
So actually we might be using any type of data!
The result of the base64url encoding of above transaction is:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">eyAKICAgICAgICAiZnJvbSI6ewogICAgICAgICAgICAibmFtZSI6ICJUaW0gWXNld3luIiwKICAgICAgICAgICAgImFjY291bnQiOiAiQ2hlY2tpbmcgYWNjb3VudCIKICAgICAgICB9LAogICAgICAgICJ0byI6ewogICAgICAgICAgICAibmFtZSI6ICJUaW0gWXNld3luIiwKICAgICAgICAgICAgImFjY291bnQiOiAiU2F2aW5ncyBhY2NvdW50IgogICAgICAgIH0sCiAgICAgICAgImFtb3VudCI6IDI1MAogICAgICAgICJjdXJyZW5jeSI6ICJFVVIiCiAgICB9</code></pre></figure>

<p>Additional parameters are associated with each payload.
One of those is the required “alg” parameter, which indicates what algorithm needs to be used to generate a signature.
Here we can also specify “none” to send unprotected messages.
All parameters are included in the final JWS.
These can either be sent as a protected or unprotected header.
The data in the unprotected header is human readable associated data, whereas data in the protected header is integrity protected and base64url encoded.
Assume we want to sign our payload using a key like we generated in the previous section.
Our datastructure would look like this:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    </span><span class="p">{</span><span class="w"> 
        </span><span class="nt">"alg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ES256"</span><span class="w">
    </span><span class="p">}</span></code></pre></figure>

<p>and base64url encoded this would be:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">eyAKICAgICAgICAiYWxnIjogIlJTMjU2IgogICAgfQ==</code></pre></figure>

<p>The base64url encoded payload and protected header are concatenated with a ‘.’ to form raw data, which is fed to the signature algorithm to produce the final signature.
Finally all of this output will be serialized using one the JSON or Compact serializations.
Compact serialization is simple concatenation of dot separated base64url encoded protected header, payload and signature.
JSON serialization is a human readable JSON object, which for the example in this section would look like this:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"payload"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyAKICAgICAgICAiZnJvbSI6ewogICAgICAgICAgICAibmFtZSI6ICJUaW0gWXNld3luIiwKICAgICAgICAgICAgImFjY291bnQiOiAiQ2hlY2tpbmcgYWNjb3VudCIKICAgICAgICB9LAogICAgICAgICJ0byI6ewogICAgICAgICAgICAibmFtZSI6ICJUaW0gWXNld3luIiwKICAgICAgICAgICAgImFjY291bnQiOiAiU2F2aW5ncyBhY2NvdW50IgogICAgICAgIH0sCiAgICAgICAgImFtb3VudCI6IDI1MAogICAgICAgICJjdXJyZW5jeSI6ICJFVVIiCiAgICB9"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"protected"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyAKICAgICAgICAiYWxnIjogIlJTMjU2IgogICAgfQ=="</span><span class="p">,</span><span class="w">
        </span><span class="nt">"header"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"signature"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DtEhU3ljbEg8L38VWAfUAqOyKAM6-Xx-F4GawxaepmXFCgfTjDxw5djxLa8ISlSApmWQxfKTUJqPP3-Kg6NU01Q"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span></code></pre></figure>

<p>Before we conclude this section, there is 1 more thing I would like to share with you.
Because we want to sign and protect our messages, we always want to use asymmetric encryption.
But, once our private key has been captured, anyone who has this can forge transactions.
One way that <strong>COULD</strong> counter this is to generate a new key pair every session, or even per transaction.
Including the public key in the protected header would not only give the server the ability the validate the signature, we will also be sure that it is the correct one since the protected header is integrity protected!</p>

<p><br /></p>

<h2 id="jwe">JWE</h2>

<p>JSON Web Encryption (<a href="https://tools.ietf.org/html/rfc7516">RFC7516</a>) follows the same logic as JWS with a few differences:</p>

<ul>
  <li>by default, for each message a new content encryption key (CEK) should be generated.
This key is used to encrypt the plaintext and is attached to the final message.
Public key of recipient or a shared key is used only to encrypt the CEK (unless direct encryption is used).</li>
  <li>only AEAD (Authenticated Encryption with Associated Data) algorithms are defined in the standard, so users do not have to think about how to combine JWE with JWS.</li>
</ul>

<p>To keep it short: While JWS can be read by everyone because of the simple base64url encoding, we could use JWE to encrypt some or all of our fields.</p>

<p><br /></p>

<h2 id="jwa">JWA</h2>

<p>JSON Web Algorithms (<a href="https://tools.ietf.org/html/rfc7518">RFC7518</a>) defines algorithms and their identifiers to be used in JWS and JWE.
The three parameters that specify algorithms are “alg” for JWS, “alg” and “enc” for JWE.
Visit following links to view the list of supported algorithms for <a href="https://tools.ietf.org/html/rfc7518#section-3">JWS</a> and <a href="https://tools.ietf.org/html/rfc7518#section-5">JWE</a></p>

<p><br /></p>

<h2 id="jwt">JWT</h2>

<p>JSON Web Tokens (<a href="https://tools.ietf.org/html/rfc7519">RFC7519</a>)</p>

<p><br /></p>

<h2 id="so-how-do-we-do-this-in-code">So, how do we do this in code?</h2>

<p>Ranging from Java and .NET to Node.js, there are already a lot of libraries available on the <a href="https://jwt.io/#libraries-io">interwebz</a>.
And even JavaScipt has its own implementation of the standard!</p>

<p>Because of its fluent API, we are using the Java JWT implementation in this post.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>io.jsonwebtoken<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>jjwt<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>0.6.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span></code></pre></figure>


    </article>
    <hr />
    <blockquote>
        
            <p>Tim is a Senior Principal Consultant at Ordina, where he helps fellow developers discovering top-notch technologies and methodologies as a Competence Leader for Microservices. He also enjoys the different challenges while developing iOS applications with Objective-C and Swift.<br />When not working for Ordina, you can find him working on various parts of the <a href="http://www.spring.io">Spring</a> framework.</p>

        
    </blockquote>
    
        <br /><br />
        <div id="disqus_thread"></div>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    
</div>
        </div>
    </div>
    <!-- Main content ends -->
</div>
<!-- Footer Starts -->
<footer class="footer">
    <!-- Container -->
    <div class="container">
        <!-- Foot Starts -->
        <div class="foot">
            <!-- Container -->
            <div class="container">
                <div class="row">
                    <div class="col-md-4 col-sm-6">
                        <!-- Foot Item -->
                        <div class="foot-item">
                            <!-- Heading -->
                            <h5 class="bold"><i class="fa fa-user"></i>&nbsp;&nbsp;Disclaimer</h5>

                            <p>Opinions expressed on this blog reflect the writer’s views and not the position of
                                Ordina.</p>

                            <div class="brand-bg">
                                <a target="_blank" href="https://www.facebook.com/lifeatordinabe" class="facebook"><i
                                        class="fa fa-facebook circle-3"></i></a>
                                <a target="_blank" href="https://twitter.com/lifeatordinabe"
                                   class="twitter"><i
                                        class="fa fa-twitter circle-3"></i></a>
                                <a target="_blank" href="https://www.linkedin.com/company/ordina-belgium"
                                   class="linkedin"><i
                                        class="fa fa-linkedin circle-3"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <!-- Foot Item -->
                        <div class="foot-item">
                            <!-- Heading -->
                            <h5 class="bold"><i class="fa fa-comments"></i>&nbsp;&nbsp;Recent Posts</h5>
                            <!-- Foot Item Content -->
                            <div class="foot-item-content">
                                <ul class="list-unstyled">
                                    
                                    <li>
                                        <span>11 Mar 2016</span> &raquo;
                                        <a href="/security/2016/03/11/Digitally-signing-your-JSON-documents.html">
                                            Digitally signing your JSON documents</a>
                                    </li>
                                    
                                    <li>
                                        <span>10 Mar 2016</span> &raquo;
                                        <a href="/conferences/2016/03/10/JavaLand2016.html">
                                            The 5 key trends of JavaLand 2016</a>
                                    </li>
                                    
                                    <li>
                                        <span>05 Mar 2016</span> &raquo;
                                        <a href="/spring/2016/03/05/HTTP-Public-Key-Pinning-with-Spring-Security.html">
                                            HTTP Public Key Pinning with Spring Security</a>
                                    </li>
                                    
                                    <li>
                                        <span>06 Feb 2016</span> &raquo;
                                        <a href="/spring/2016/02/06/Generating-Spring-REST-Docs-without-using-integration-tests.html">
                                            Generating Spring REST Docs without using integration tests</a>
                                    </li>
                                    
                                    <li>
                                        <span>02 Feb 2016</span> &raquo;
                                        <a href="/domain-driven%20design/2016/02/02/A-Decade-Of-DDD-CQRS-And-Event-Sourcing.html">
                                            A decade of DDD, CQRS and Event Sourcing</a>
                                    </li>
                                    
                                    <li>
                                        <span>29 Jan 2016</span> &raquo;
                                        <a href="/domain-driven%20design/2016/01/29/DDDEU16-Odds-and-Ends.html">
                                            oDDs and enDs: Vaughn Vernon  on software projects in peril</a>
                                    </li>
                                    
                                    <li>
                                        <span>29 Jan 2016</span> &raquo;
                                        <a href="/domain-driven%20design/2016/01/29/DDD-Europe-Heuristics-from-the-Trenches.html">
                                            Heuristics from the Trenches by Cyrille Martraire</a>
                                    </li>
                                    
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <!-- Foot Item -->
                        <div class="foot-item">
                            <!-- Heading -->
                            <h5 class="bold"><i class="fa fa-building-o"></i>&nbsp;&nbsp;Contact Us</h5>
                            <!-- Foot Item Content -->
                            <div class="foot-item-content address">
                                <!-- Heading -->
                                <h6 class="bold"><i class="fa fa-home"></i>&nbsp;&nbsp;Ordina Belgium</h6>
                                <!-- Paragraph -->
                                <p class="add">
                                    Blarenberglaan 3B,<br/>
                                    Mechelen 2800, Belgium.</p>

                                <p class="tel"><i class="fa fa-phone"></i> Tel : + (32) - 15 29 58 58<br/>
                                    <i class="fa fa-envelope"></i> Mail : <a href="#">info@ordina.be</a><br/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Foot Ends -->
        <!-- Footer Content -->
        <p class="pull-left">Copyright &copy; 2016 - <a href="#">Ordina JWorks</a></p>
        <ul class="list-inline pull-right">
            <!-- List -->
            <li><a href="/">Home</a>
            <li><a href="/about/">About</a></li>
            <li><a href="/contact/">Contact</a></li>
        </ul>
        <!-- Clearfix -->
        <div class="clearfix"></div>
    </div>
</footer>
<!-- Footer Ends -->

<!-- Outer Ends -->

<!-- Scroll to top -->
<span class="totop"><a href="#"><i class="fa fa-angle-up bg-color"></i></a></span>

<script src="/js/jquery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/placeholders.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/respond.min.js"></script>
<script src="/js/html5shiv.js"></script>
<script src="/js/main.js"></script>

<script src="/js/imagesloaded.min.js"></script>
<script src="/js/masonry.js"></script>

<!-- Javascript for this page -->
<script>
    // Initialize Masonry
    var $box = $('.blog-masonry').masonry();
    // Layout Masonry again after all images have loaded
    $box.imagesLoaded(function () {
        $box.masonry();
    });
</script>

<!-- Custom JS. Type your JS code in custom.js file -->
<script src="/js/custom.js"></script>
    
<!-- Disqus -->

    <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = "https://ordina-jworks.github.io/security/2016/03/11/Digitally-signing-your-JSON-documents.html";
            this.page.identifier = "/security/2016/03/11/Digitally-signing-your-JSON-documents.html";
            this.page.title = "Digitally signing your JSON documents";
        };
    </script>
    <script src="//ordina-jworks.disqus.com/embed.js" async></script>


<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
        a = s.createElement(o);
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-70040502-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>